<!DOCTYPE html>
<html class="fancyScroll">
<head>
  <meta charset="utf-8">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  
  <link href="../../../../css/vuetify.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

  <title>LoRaWAN Nano-gateway </title>
  <meta name="description" content="">

  <script src="../../../../js/smooth-scroll.js"></script>
  <link href="../../../../css/doc-theme.css%3F.css" rel="stylesheet">
  <link rel="icon" href="../../../../favicon.ico">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>
<body>
</script>
<v-app id="app" class=""  v-cloak style="background-color: white;">
   <v-navigation-drawer
  v-model="drawer"
  fixed
  app
  class="lighten-4 pt-0"
  style="overflow-y: hidden; overflow-x: hidden;margin-top:68px;"
>

  <div class="fancyScroll pa-0 ma-0" style="overflow-y: scroll; overflow-x: hidden;
      max-height: 100%;" >

    <v-divider class="mr-2 ml-1 mb-4" style="border: 0"></v-divider>

      <ul class="lefttree">
        <li class="lefttree">
            <a href="../../../../index.html" class="beba" style="color: #1E1E3C; text-decoration: none;" >
              <v-icon style="color: #1E1E3C;">home</v-icon> Introduction</a>
        </li>
      </ul>

    


<ul class="lefttree ">

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../gettingstarted/registration/lora/helium_hotspot_registration/index.html" class="">Pycom Helium Miner</a>
    </li>

  

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../products/index.html" class="">Pycom Products</a>
    </li>

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../gettingstarted/index.html" class="">  Getting Started</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree padleft hot" >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../index.html" class="hot">  Tutorials &amp; Examples</a>
      
      
        


<ul class="lefttree ">

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../basic/index.html" class="">  Basic</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../hardware/index.html" class="">  Hardware</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree padleft hot" >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../index.html" class="hot">  Networks</a>
      
      
        


<ul class="lefttree ">

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../wlan.html" class="">WiFi</a>
    </li>

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../ble.html" class="">  BLE</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../sigfox.html" class="">  SigFox</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree padleft hot" >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../index.html" class="hot">  LoRa</a>
      
      
        


<ul class="lefttree ">

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../lorawan-abp.html" class="">LoRaWAN ABP</a>
    </li>

  

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../lorawan-otaa.html" class="">LoRaWAN OTAA</a>
    </li>

  

  
  
  
  
  


    <li class="lefttree hot">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="index.html" class="hot">LoRaWAN Gateway</a>
    </li>

  

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../lora-mac/index.html" class="">LoRa RAW</a>
    </li>

  

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../lora-mac-nano-gateway/index.html" class="">LoRa RAW Gateway</a>
    </li>

  

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../module-module/index.html" class="">Lopy to Lopy</a>
    </li>

  

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../nvram/index.html" class="">nvram</a>
    </li>

  

</ul>

      

      
    </li>
      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../lte/index.html" class="">  LTE</a>
      
      

      

  

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../ethernet/index.html" class="">Ethernet</a>
    </li>

  

</ul>

      

      
    </li>
      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../networkprotocols/index.html" class="">  Network Protocols</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../expansionboards/index.html" class="">  Shields</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../pynode/index.html" class="">  PyNode&#43;</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../advanced/index.html" class="">  Advanced</a>
      
      

      

  

</ul>

      

      
    </li>
      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../firmwareapi/index.html" class="">  Firmware &amp; API Reference</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../datasheets/index.html" class="">  Product Info, Datasheets</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../updatefirmware/index.html" class="">  Update Firmware</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../pybytes/index.html" class="">  Pybytes</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../cellularservices/index.html" class="">  Cellular Services</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../pylife/index.html" class="">  Pylife</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../pymesh.html" class="">  Pymesh</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../docnotes/index.html" class="">  Micropython Support</a>
      
      

      

  

  
  
  
  
  

  
    <li class="lefttree " >
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../advance/downgrade.html" class="">  Advanced topics</a>
      
      

      

  

  
  
  
  
  


    <li class="lefttree ">
      <v-icon style="color: transparent; display: hidden;" >done</v-icon>
      <a href="../../../../license/index.html" class="">License</a>
    </li>

  

</ul>


    <v-divider class="grey lighten-1 ma-2 mt-4 mb-4"></v-divider>

    <ul class="lefttree" >Have a question ?
      <li class="lefttree">  <a href="https://forum.pycom.io">Ask on the forum</a>
    </ul>
    <p>&nbsp;</p>
      <p>&nbsp;</p>
  </div>
</v-navigation-drawer>
<v-toolbar
  app
  fixed
  height=68
  class="pr-3 pl-2 navbar"
  dark
  style="background-color: #171730;"
  flat
>
  <v-toolbar-title style="width: 260px; " class="ml-4 pl-0  pt-2 text-xs-center hidden-sm-and-down">
    <v-img class="ml-4"  height=48 width=190  src="/logo.svg" class="">
  </v-toolbar-title>

    <v-btn icon @click.stop="drawer = !drawer" style="z-index: 1200;">
      <v-icon>toc</v-icon>
    </v-btn>
    <span class="beba" style="font-size: 1.6rem; opacity: 0.85;">
        LoRaWAN Nano-gateway
    </span>

  <v-text-field
    style="max-width: 650px"
    class="ml-3 algolia-search-field"
    light
    hide-details
    label="Search the docs..."
    solo
    append-icon="search"
  ></v-text-field>

  <v-spacer></v-spacer>
  <v-btn icon ref="tocBtn" @click.stop="drawer2 = !drawer2" >
    <v-icon style="color: rgb(23, 255, 189);">more_vert</v-icon>
  </v-btn>
  
</v-toolbar>
<v-content >
      <v-container class="fluid pa-4" style="padding-top: 0 !important;">
          <v-container class="ma-1 pa-1"><v-slide-y-transition>
    <v-card class="menu-contextual" v-if="drawer2" @click.stop="drawer2 = !drawer2">
      <v-card-title class="beba" style="height: 68px; background-color: #1E1E3C; color: #17FFBD">
        What's in this document
        <v-btn icon @click.stop="drawer2 = !drawer2" style="color: #17FFBD; position: absolute; right: 0; top: 4px;;">
          <v-icon>more_vert</v-icon>
        </v-btn>


      </v-card-title>
      <v-card-text class="fancyScroll righttree">
    <nav id="TableOfContents">
  <ul>
    <li class="righttree"><a href="index.html#nano-gateway-setup">Nano-gateway setup</a>
      <ul>
        <li class="righttree"><a href="index.html#gateway-id">Gateway ID</a></li>
        <li class="righttree"><a href="index.html#mainpy">main.py</a></li>
        <li class="righttree"><a href="index.html#configpy">config.py</a></li>
        <li class="righttree"><a href="index.html#nanogatewaypy">nanogateway.py</a></li>
      </ul>
    </li>
    <li class="righttree"><a href="index.html#nano-gateway-node">Nano-gateway node</a></li>
    <li class="righttree"><a href="index.html#registering-with-ttn">Registering with TTN</a></li>
  </ul>
</nav>
      </v-card-text>
    </v-card>
</v-slide-y-transition>





<v-card flat class="DocSearch-content">
  <v-card-text>
    
    








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  


</ul>

    

  


</ul>

    

  






  
  

  

  
      

      <a href="../../../index.html" class="bread hot">  Tutorials &amp; Examples</a>
        >
      
        








  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      

      <a href="../../index.html" class="bread hot">  Networks</a>
        >
      
        








  
  

  

  
    

      

  
  






  
  

  

  
      
        








  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      

      <a href="../index.html" class="bread hot">  LoRa</a>
        >
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      <a href="index.html" class="bread">LoRaWAN Gateway </a>

      

      
      

        

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    


    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
    

      

  
  


</ul>

    


    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  


</ul>

    

  


</ul>

    


    

  






  
  

  

  
      
        








  
  

  

  
      
        








  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
    

      

  
  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
      
        








  
  

  

  
      
        








  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  


</ul>

    

  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
      
        








  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
      
        








  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  






  
  

  

  
    

      

  
  


</ul>

    

  






  
  

  

  
    

      

  
  


</ul>

    
    <h1 class="mt-0 pt-0">LoRaWAN Nano-gateway</h1><p>This example allows a development module to act as a single channel gateway, and connect to a LoRaWAN network such as The Things Stack (TTS), Helium or Loriot.
The files can be found in our <a href="https://github.com/pycom/pycom-libraries/tree/master/examples/lorawan-nano-gateway">GitHub Repository</a>.</p>
<h2 id="nano-gateway-setup">Nano-gateway setup</h2>
<p>The functionality of the Nano-Gateway is split into 3 files, <code>main.py</code>, <code>config.py</code> and <code>nanogateway.py</code>. These are used to configure and specify how the gateway will connect to a preferred network and how it can act as packet forwarder.</p>
<h3 id="gateway-id">Gateway ID</h3>
<p>Most LoRaWAN network servers expect a Gateway ID in the form of a unique 64-bit hexadecimal number (called a EUI-64). The recommended practice is to produce this ID from your board by expanding the WiFi MAC address (a 48-bit number, called MAC-48). You can obtain that by running this code prior to configuration:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#007020;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">network</span> <span style="color:#007020;font-weight:bold">import</span> WLAN
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">ubinascii</span>
wl <span style="color:#666">=</span> WLAN()
ubinascii<span style="color:#666">.</span>hexlify(wl<span style="color:#666">.</span>mac())[:<span style="color:#40a070">6</span>] <span style="color:#666">+</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">FFFE</span><span style="color:#4070a0">&#39;</span> <span style="color:#666">+</span> ubinascii<span style="color:#666">.</span>hexlify(wl<span style="color:#666">.</span>mac())[<span style="color:#40a070">6</span>:]
</code></pre></div><p>The result will by something like <code>b'240ac4FFFE008d88'</code> where <code>240ac4FFFE008d88</code> is your Gateway ID to be used in your network provider configuration.</p>
<h3 id="mainpy">main.py</h3>
<p>This file runs at boot and calls the library and <code>config.py</code> files to initialise the nano-gateway. Once configuration is set, the nano-gateway is then started.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0"> LoPy LoRaWAN Nano Gateway example usage </span><span style="color:#4070a0">&#34;&#34;&#34;</span>
<span style="color:#60a0b0;font-style:italic"># Acknowledgement:</span>
<span style="color:#60a0b0;font-style:italic"># Thanks to robert-hh for providing us with an updated, more stable example for the nanogateway </span>

<span style="color:#60a0b0;font-style:italic"># disable heartbeat</span>
<span style="color:#007020;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">pycom</span> <span style="color:#007020;font-weight:bold">import</span> heartbeat
heartbeat(False)
<span style="color:#007020;font-weight:bold">print</span> (<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">Heartbeat off</span><span style="color:#4070a0">&#34;</span>)


<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">utime</span>
<span style="color:#007020;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">machine</span> <span style="color:#007020;font-weight:bold">import</span> RTC
rtc <span style="color:#666">=</span> RTC()
rtc<span style="color:#666">.</span>ntp_sync(<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">pool.ntp.org</span><span style="color:#4070a0">&#34;</span>)
utime<span style="color:#666">.</span>sleep_ms(<span style="color:#40a070">750</span>)
t <span style="color:#666">=</span> rtc<span style="color:#666">.</span>now()
<span style="color:#007020;font-weight:bold">with</span> <span style="color:#007020">open</span>(<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">bootlog.txt</span><span style="color:#4070a0">&#34;</span>, <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">a</span><span style="color:#4070a0">&#34;</span>) <span style="color:#007020;font-weight:bold">as</span> f:
   f<span style="color:#666">.</span>write(<span style="color:#007020">repr</span>(utime<span style="color:#666">.</span>time()) <span style="color:#666">+</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0"> </span><span style="color:#4070a0">&#34;</span> <span style="color:#666">+</span> <span style="color:#007020">repr</span>(t) <span style="color:#666">+</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0;font-weight:bold">\n</span><span style="color:#4070a0">&#34;</span>)

<span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">reload</span>(mod):
    <span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">sys</span>
    mod_name <span style="color:#666">=</span> mod<span style="color:#666">.</span>__name__
    <span style="color:#007020;font-weight:bold">del</span> sys<span style="color:#666">.</span>modules[mod_name]
    <span style="color:#007020;font-weight:bold">return</span> <span style="color:#007020">__import__</span>(mod_name)

<span style="color:#007020;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">machine</span> <span style="color:#007020;font-weight:bold">import</span> reset

<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0"> LoPy LoRaWAN Nano Gateway example usage </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">config</span>
<span style="color:#007020;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">nanogateway</span> <span style="color:#007020;font-weight:bold">import</span> NanoGateway

<span style="color:#007020;font-weight:bold">if</span> True: <span style="color:#60a0b0;font-style:italic">#__name__ == &#39;__main__&#39;:</span>
    nanogw <span style="color:#666">=</span> NanoGateway(
        <span style="color:#007020">id</span><span style="color:#666">=</span>config<span style="color:#666">.</span>GATEWAY_ID,
        frequency<span style="color:#666">=</span>config<span style="color:#666">.</span>LORA_FREQUENCY,
        datarate<span style="color:#666">=</span>config<span style="color:#666">.</span>LORA_GW_DR,
        ssid<span style="color:#666">=</span>config<span style="color:#666">.</span>WIFI_SSID,
        password<span style="color:#666">=</span>config<span style="color:#666">.</span>WIFI_PASS,
        server<span style="color:#666">=</span>config<span style="color:#666">.</span>SERVER,
        port<span style="color:#666">=</span>config<span style="color:#666">.</span>PORT,
        ntp_server<span style="color:#666">=</span>config<span style="color:#666">.</span>NTP,
        ntp_period<span style="color:#666">=</span>config<span style="color:#666">.</span>NTP_PERIOD_S
        )

    nanogw<span style="color:#666">.</span>start()
    <span style="color:#60a0b0;font-style:italic">#nanogw._log(&#39;You may now press ENTER to enter the REPL&#39;)</span>
    <span style="color:#60a0b0;font-style:italic">#input()</span>

</code></pre></div><h3 id="configpy">config.py</h3>
<p>This file contains settings for the server and network it is connecting to. Depending on the nano-gateway region and provider (TTN, Loriot, etc.) these will vary. The provided example will work with The Things Network (TTN) in the European, 868Mhz, region.</p>
<p>The Gateway ID is generated in the script using the process described above.</p>
<p><strong>Please change the WIFI_SSID and WIFI_PASS variables to match your desired WiFi network</strong></p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0"> LoPy LoRaWAN Nano Gateway configuration options </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">machine</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">ubinascii</span>

WIFI_MAC <span style="color:#666">=</span> ubinascii<span style="color:#666">.</span>hexlify(machine<span style="color:#666">.</span>unique_id())<span style="color:#666">.</span>upper()
<span style="color:#60a0b0;font-style:italic"># Set  the Gateway ID to be the first 3 bytes of MAC address + &#39;FFFE&#39; + last 3 bytes of MAC address</span>
<span style="color:#60a0b0;font-style:italic"># GATEWAY_ID = WIFI_MAC[:6] + &#34;FFFE&#34; + WIFI_MAC[6:12]</span>
GATEWAY_ID <span style="color:#666">=</span> WIFI_MAC[:<span style="color:#40a070">6</span>] <span style="color:#666">+</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">FFFF</span><span style="color:#4070a0">&#34;</span> <span style="color:#666">+</span> WIFI_MAC[<span style="color:#40a070">6</span>:<span style="color:#40a070">12</span>]
SERVER <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">router.eu.thethings.network</span><span style="color:#4070a0">&#39;</span>
<span style="color:#60a0b0;font-style:italic">#for TTS v3, use &#39;eu1.cloud.thethings.network&#39;</span>
PORT <span style="color:#666">=</span> <span style="color:#40a070">1700</span>

NTP <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">pool.ntp.org</span><span style="color:#4070a0">&#34;</span>
NTP_PERIOD_S <span style="color:#666">=</span> <span style="color:#40a070">3600</span>

WIFI_SSID <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">&#39;</span>
WIFI_PASS <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">&#39;</span>

<span style="color:#60a0b0;font-style:italic"># for IN865</span>
<span style="color:#60a0b0;font-style:italic"># LORA_FREQUENCY = 865062500</span>
<span style="color:#60a0b0;font-style:italic"># LORA_GW_DR = &#34;SF7BW125&#34; # DR_5</span>
<span style="color:#60a0b0;font-style:italic"># LORA_NODE_DR = 5</span>

<span style="color:#60a0b0;font-style:italic"># for EU868</span>
LORA_FREQUENCY <span style="color:#666">=</span> <span style="color:#40a070">868500000</span>
LORA_GW_DR <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">SF7BW125</span><span style="color:#4070a0">&#34;</span> <span style="color:#60a0b0;font-style:italic"># DR_5</span>
LORA_NODE_DR <span style="color:#666">=</span> <span style="color:#40a070">5</span>

<span style="color:#60a0b0;font-style:italic"># for US915</span>
<span style="color:#60a0b0;font-style:italic"># LORA_FREQUENCY = 903900000</span>
<span style="color:#60a0b0;font-style:italic"># LORA_GW_DR = &#34;SF7BW125&#34; # DR_3</span>
<span style="color:#60a0b0;font-style:italic"># LORA_NODE_DR = 3</span>
</code></pre></div><h3 id="nanogatewaypy">nanogateway.py</h3>
<p>The nano-gateway library controls all of the packet generation and forwarding for the LoRa data. This does not require any user configuration and the latest version of this code should be downloaded from the Pycom <a href="https://github.com/pycom/pycom-libraries/tree/master/examples/lorawan-nano-gateway">GitHub Repository</a>.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0"> LoPy LoRaWAN Nano Gateway. Can be used for both EU868 and US915. </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">errno</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">machine</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">ubinascii</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">ujson</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">uos</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">usocket</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">utime</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">_thread</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">gc</span>
<span style="color:#007020;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">micropython</span> <span style="color:#007020;font-weight:bold">import</span> const
<span style="color:#007020;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">network</span> <span style="color:#007020;font-weight:bold">import</span> LoRa
<span style="color:#007020;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">network</span> <span style="color:#007020;font-weight:bold">import</span> WLAN
<span style="color:#007020;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">machine</span> <span style="color:#007020;font-weight:bold">import</span> Timer
<span style="color:#007020;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">machine</span> <span style="color:#007020;font-weight:bold">import</span> WDT

PROTOCOL_VERSION <span style="color:#666">=</span> const(<span style="color:#40a070">2</span>)

PUSH_DATA <span style="color:#666">=</span> const(<span style="color:#40a070">0</span>)
PUSH_ACK <span style="color:#666">=</span> const(<span style="color:#40a070">1</span>)
PULL_DATA <span style="color:#666">=</span> const(<span style="color:#40a070">2</span>)
PULL_ACK <span style="color:#666">=</span> const(<span style="color:#40a070">4</span>)
PULL_RESP <span style="color:#666">=</span> const(<span style="color:#40a070">3</span>)

TX_ERR_NONE <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">NONE</span><span style="color:#4070a0">&#39;</span>
TX_ERR_TOO_LATE <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">TOO_LATE</span><span style="color:#4070a0">&#39;</span>
TX_ERR_TOO_EARLY <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">TOO_EARLY</span><span style="color:#4070a0">&#39;</span>
TX_ERR_COLLISION_PACKET <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">COLLISION_PACKET</span><span style="color:#4070a0">&#39;</span>
TX_ERR_COLLISION_BEACON <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">COLLISION_BEACON</span><span style="color:#4070a0">&#39;</span>
TX_ERR_TX_FREQ <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">TX_FREQ</span><span style="color:#4070a0">&#39;</span>
TX_ERR_TX_POWER <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">TX_POWER</span><span style="color:#4070a0">&#39;</span>
TX_ERR_GPS_UNLOCKED <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">GPS_UNLOCKED</span><span style="color:#4070a0">&#39;</span>

UDP_THREAD_CYCLE_MS <span style="color:#666">=</span> const(<span style="color:#40a070">10</span>)
WDT_TIMEOUT <span style="color:#666">=</span> const(<span style="color:#40a070">120</span>)


STAT_PK <span style="color:#666">=</span> {
    <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">stat</span><span style="color:#4070a0">&#39;</span>: {
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">time</span><span style="color:#4070a0">&#39;</span>: <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">&#39;</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">lati</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">long</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">alti</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">rxnb</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">rxok</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">rxfw</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">ackr</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">100.0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">dwnb</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">txnb</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>
    }
}

RX_PK <span style="color:#666">=</span> {
    <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">rxpk</span><span style="color:#4070a0">&#39;</span>: [{
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">time</span><span style="color:#4070a0">&#39;</span>: <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">&#39;</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">tmst</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">chan</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">rfch</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">freq</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">stat</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">1</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">modu</span><span style="color:#4070a0">&#39;</span>: <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">LORA</span><span style="color:#4070a0">&#39;</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">datr</span><span style="color:#4070a0">&#39;</span>: <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">&#39;</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">codr</span><span style="color:#4070a0">&#39;</span>: <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">4/5</span><span style="color:#4070a0">&#39;</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">rssi</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">lsnr</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">size</span><span style="color:#4070a0">&#39;</span>: <span style="color:#40a070">0</span>,
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">data</span><span style="color:#4070a0">&#39;</span>: <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">&#39;</span>
    }]
}

TX_ACK_PK <span style="color:#666">=</span> {
    <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">txpk_ack</span><span style="color:#4070a0">&#39;</span>: {
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">error</span><span style="color:#4070a0">&#39;</span>: <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">&#39;</span>
    }
}


<span style="color:#007020;font-weight:bold">class</span> <span style="color:#0e84b5;font-weight:bold">NanoGateway</span>:
    <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">    Nano gateway class, set up by default for use with TTN, but can be configured</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">    for any other network supporting the Semtech Packet Forwarder.</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">    Only required configuration is wifi_ssid and wifi_password which are used for</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">    connecting to the Internet.</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">    </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

    <span style="color:#007020;font-weight:bold">def</span> __init__(self, <span style="color:#007020">id</span>, frequency, datarate, ssid, password, server, port, ntp_server<span style="color:#666">=</span><span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">pool.ntp.org</span><span style="color:#4070a0">&#39;</span>, ntp_period<span style="color:#666">=</span><span style="color:#40a070">3600</span>):
        self<span style="color:#666">.</span>id <span style="color:#666">=</span> <span style="color:#007020">id</span>
        self<span style="color:#666">.</span>server <span style="color:#666">=</span> server
        self<span style="color:#666">.</span>port <span style="color:#666">=</span> port

        self<span style="color:#666">.</span>frequency <span style="color:#666">=</span> frequency
        self<span style="color:#666">.</span>datarate <span style="color:#666">=</span> datarate

        self<span style="color:#666">.</span>ssid <span style="color:#666">=</span> ssid
        self<span style="color:#666">.</span>password <span style="color:#666">=</span> password

        self<span style="color:#666">.</span>ntp_server <span style="color:#666">=</span> ntp_server
        self<span style="color:#666">.</span>ntp_period <span style="color:#666">=</span> ntp_period

        self<span style="color:#666">.</span>server_ip <span style="color:#666">=</span> None

        self<span style="color:#666">.</span>rxnb <span style="color:#666">=</span> <span style="color:#40a070">0</span>
        self<span style="color:#666">.</span>rxok <span style="color:#666">=</span> <span style="color:#40a070">0</span>
        self<span style="color:#666">.</span>rxfw <span style="color:#666">=</span> <span style="color:#40a070">0</span>
        self<span style="color:#666">.</span>dwnb <span style="color:#666">=</span> <span style="color:#40a070">0</span>
        self<span style="color:#666">.</span>txnb <span style="color:#666">=</span> <span style="color:#40a070">0</span>

        self<span style="color:#666">.</span>sf <span style="color:#666">=</span> self<span style="color:#666">.</span>_dr_to_sf(self<span style="color:#666">.</span>datarate)
        self<span style="color:#666">.</span>bw <span style="color:#666">=</span> self<span style="color:#666">.</span>_dr_to_bw(self<span style="color:#666">.</span>datarate)

        self<span style="color:#666">.</span>stat_alarm <span style="color:#666">=</span> None
        self<span style="color:#666">.</span>pull_alarm <span style="color:#666">=</span> None
        self<span style="color:#666">.</span>uplink_alarm <span style="color:#666">=</span> None

        self<span style="color:#666">.</span>wlan <span style="color:#666">=</span> None
        self<span style="color:#666">.</span>sock <span style="color:#666">=</span> None
        self<span style="color:#666">.</span>udp_stop <span style="color:#666">=</span> False
        self<span style="color:#666">.</span>udp_lock <span style="color:#666">=</span> _thread<span style="color:#666">.</span>allocate_lock()

        self<span style="color:#666">.</span>lora <span style="color:#666">=</span> None
        self<span style="color:#666">.</span>lora_sock <span style="color:#666">=</span> None

        self<span style="color:#666">.</span>rtc <span style="color:#666">=</span> machine<span style="color:#666">.</span>RTC()

        self<span style="color:#666">.</span>watchdog <span style="color:#666">=</span> WDT(timeout<span style="color:#666">=</span><span style="color:#40a070">10000</span>)

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">start</span>(self):
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        Starts the LoRaWAN nano gateway.</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Starting LoRaWAN nano gateway with id: {}</span><span style="color:#4070a0">&#39;</span>, self<span style="color:#666">.</span>id)

        <span style="color:#60a0b0;font-style:italic"># setup WiFi as a station and connect</span>
        self<span style="color:#666">.</span>wlan <span style="color:#666">=</span> WLAN(mode<span style="color:#666">=</span>WLAN<span style="color:#666">.</span>STA)
        self<span style="color:#666">.</span>_connect_to_wifi()
        self<span style="color:#666">.</span>watchdog<span style="color:#666">.</span>feed()
        <span style="color:#60a0b0;font-style:italic"># get a time sync</span>
        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Syncing time with {} ...</span><span style="color:#4070a0">&#39;</span>, self<span style="color:#666">.</span>ntp_server)
        self<span style="color:#666">.</span>rtc<span style="color:#666">.</span>ntp_sync(self<span style="color:#666">.</span>ntp_server, update_period<span style="color:#666">=</span>self<span style="color:#666">.</span>ntp_period)
        <span style="color:#007020;font-weight:bold">while</span> <span style="color:#007020;font-weight:bold">not</span> self<span style="color:#666">.</span>rtc<span style="color:#666">.</span>synced():
            utime<span style="color:#666">.</span>sleep_ms(<span style="color:#40a070">50</span>)
            self<span style="color:#666">.</span>watchdog<span style="color:#666">.</span>feed()
        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">RTC NTP sync complete</span><span style="color:#4070a0">&#34;</span>)
        self<span style="color:#666">.</span>watchdog<span style="color:#666">.</span>feed()
        <span style="color:#60a0b0;font-style:italic"># get the server IP and create an UDP socket</span>
        self<span style="color:#666">.</span>server_ip <span style="color:#666">=</span> usocket<span style="color:#666">.</span>getaddrinfo(self<span style="color:#666">.</span>server, self<span style="color:#666">.</span>port)[<span style="color:#40a070">0</span>][<span style="color:#666">-</span><span style="color:#40a070">1</span>]
        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Opening UDP socket to {} ({}) port {}...</span><span style="color:#4070a0">&#39;</span>, self<span style="color:#666">.</span>server, self<span style="color:#666">.</span>server_ip[<span style="color:#40a070">0</span>], self<span style="color:#666">.</span>server_ip[<span style="color:#40a070">1</span>])
        self<span style="color:#666">.</span>sock <span style="color:#666">=</span> usocket<span style="color:#666">.</span>socket(usocket<span style="color:#666">.</span>AF_INET, usocket<span style="color:#666">.</span>SOCK_DGRAM, usocket<span style="color:#666">.</span>IPPROTO_UDP)
        self<span style="color:#666">.</span>sock<span style="color:#666">.</span>setsockopt(usocket<span style="color:#666">.</span>SOL_SOCKET, usocket<span style="color:#666">.</span>SO_REUSEADDR, <span style="color:#40a070">1</span>)
        self<span style="color:#666">.</span>sock<span style="color:#666">.</span>setblocking(False)

        <span style="color:#60a0b0;font-style:italic"># push the first time immediatelly</span>
        self<span style="color:#666">.</span>_push_data(self<span style="color:#666">.</span>_make_stat_packet())

        <span style="color:#60a0b0;font-style:italic"># create the alarms</span>
        self<span style="color:#666">.</span>stat_alarm <span style="color:#666">=</span> Timer<span style="color:#666">.</span>Alarm(handler<span style="color:#666">=</span><span style="color:#007020;font-weight:bold">lambda</span> t: self<span style="color:#666">.</span>_push_data(self<span style="color:#666">.</span>_make_stat_packet()), s<span style="color:#666">=</span><span style="color:#40a070">60</span>, periodic<span style="color:#666">=</span>True)
        self<span style="color:#666">.</span>pull_alarm <span style="color:#666">=</span> Timer<span style="color:#666">.</span>Alarm(handler<span style="color:#666">=</span><span style="color:#007020;font-weight:bold">lambda</span> u: self<span style="color:#666">.</span>_pull_data(), s<span style="color:#666">=</span><span style="color:#40a070">25</span>, periodic<span style="color:#666">=</span>True)

        <span style="color:#60a0b0;font-style:italic"># start the watchdog</span>
        self<span style="color:#666">.</span>watchdog<span style="color:#666">.</span>feed()
        utime<span style="color:#666">.</span>sleep(<span style="color:#40a070">1</span>)
        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">Watchdog started</span><span style="color:#4070a0">&#34;</span>)

        <span style="color:#60a0b0;font-style:italic"># start the UDP receive thread</span>
        self<span style="color:#666">.</span>udp_stop <span style="color:#666">=</span> False
        _thread<span style="color:#666">.</span>start_new_thread(self<span style="color:#666">.</span>_udp_thread, ())
        self<span style="color:#666">.</span>watchdog<span style="color:#666">.</span>feed()
        <span style="color:#60a0b0;font-style:italic"># initialize the LoRa radio in LORA mode</span>
        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Setting up the LoRa radio at {} Mhz using {}</span><span style="color:#4070a0">&#39;</span>, self<span style="color:#666">.</span>_freq_to_float(self<span style="color:#666">.</span>frequency), self<span style="color:#666">.</span>datarate)
        self<span style="color:#666">.</span>lora <span style="color:#666">=</span> LoRa(
            mode<span style="color:#666">=</span>LoRa<span style="color:#666">.</span>LORA,
            region<span style="color:#666">=</span>LoRa<span style="color:#666">.</span>EU868,
            frequency<span style="color:#666">=</span>self<span style="color:#666">.</span>frequency,
            bandwidth<span style="color:#666">=</span>self<span style="color:#666">.</span>bw,
            sf<span style="color:#666">=</span>self<span style="color:#666">.</span>sf,
            preamble<span style="color:#666">=</span><span style="color:#40a070">8</span>,
            coding_rate<span style="color:#666">=</span>LoRa<span style="color:#666">.</span>CODING_4_5,
            tx_iq<span style="color:#666">=</span>True
        )

        <span style="color:#60a0b0;font-style:italic"># create a raw LoRa socket</span>
        self<span style="color:#666">.</span>lora_sock <span style="color:#666">=</span> usocket<span style="color:#666">.</span>socket(usocket<span style="color:#666">.</span>AF_LORA, usocket<span style="color:#666">.</span>SOCK_RAW)
        self<span style="color:#666">.</span>lora_sock<span style="color:#666">.</span>setblocking(False)
        self<span style="color:#666">.</span>lora_tx_done <span style="color:#666">=</span> False
        self<span style="color:#666">.</span>watchdog<span style="color:#666">.</span>feed()
        self<span style="color:#666">.</span>lora<span style="color:#666">.</span>callback(trigger<span style="color:#666">=</span>(LoRa<span style="color:#666">.</span>RX_PACKET_EVENT <span style="color:#666">|</span> LoRa<span style="color:#666">.</span>TX_PACKET_EVENT), handler<span style="color:#666">=</span>self<span style="color:#666">.</span>_lora_cb)
        self<span style="color:#666">.</span>watchdog<span style="color:#666">.</span>feed()
        <span style="color:#007020;font-weight:bold">if</span> uos<span style="color:#666">.</span>uname()[<span style="color:#40a070">0</span>] <span style="color:#666">==</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">LoPy</span><span style="color:#4070a0">&#34;</span>:
            self<span style="color:#666">.</span>window_compensation <span style="color:#666">=</span> <span style="color:#666">-</span><span style="color:#40a070">1000</span>
        <span style="color:#007020;font-weight:bold">else</span>:
            self<span style="color:#666">.</span>window_compensation <span style="color:#666">=</span> <span style="color:#666">-</span><span style="color:#40a070">6000</span>
        self<span style="color:#666">.</span>watchdog<span style="color:#666">.</span>feed()
        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">LoRaWAN nano gateway online</span><span style="color:#4070a0">&#39;</span>)

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">stop</span>(self):
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        Stops the LoRaWAN nano gateway.</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Stopping...</span><span style="color:#4070a0">&#39;</span>)

        <span style="color:#60a0b0;font-style:italic"># send the LoRa radio to sleep</span>
        self<span style="color:#666">.</span>lora<span style="color:#666">.</span>callback(trigger<span style="color:#666">=</span>None, handler<span style="color:#666">=</span>None)
        self<span style="color:#666">.</span>lora<span style="color:#666">.</span>power_mode(LoRa<span style="color:#666">.</span>SLEEP)

        <span style="color:#60a0b0;font-style:italic"># stop the NTP sync</span>
        self<span style="color:#666">.</span>rtc<span style="color:#666">.</span>ntp_sync(None)

        <span style="color:#60a0b0;font-style:italic"># cancel all the alarms</span>
        self<span style="color:#666">.</span>stat_alarm<span style="color:#666">.</span>cancel()
        self<span style="color:#666">.</span>pull_alarm<span style="color:#666">.</span>cancel()

        <span style="color:#60a0b0;font-style:italic"># signal the UDP thread to stop</span>
        self<span style="color:#666">.</span>udp_stop <span style="color:#666">=</span> True
        <span style="color:#007020;font-weight:bold">while</span> self<span style="color:#666">.</span>udp_stop:
            utime<span style="color:#666">.</span>sleep_ms(<span style="color:#40a070">50</span>)

        <span style="color:#60a0b0;font-style:italic"># disable WLAN</span>
        self<span style="color:#666">.</span>wlan<span style="color:#666">.</span>disconnect()
        self<span style="color:#666">.</span>wlan<span style="color:#666">.</span>deinit()

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_connect_to_wifi</span>(self):
        self<span style="color:#666">.</span>wlan<span style="color:#666">.</span>connect(self<span style="color:#666">.</span>ssid, auth<span style="color:#666">=</span>(None, self<span style="color:#666">.</span>password))
        <span style="color:#007020;font-weight:bold">while</span> <span style="color:#007020;font-weight:bold">not</span> self<span style="color:#666">.</span>wlan<span style="color:#666">.</span>isconnected():
            utime<span style="color:#666">.</span>sleep_ms(<span style="color:#40a070">50</span>)
            self<span style="color:#666">.</span>watchdog<span style="color:#666">.</span>feed()
        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">WiFi connected to: {}</span><span style="color:#4070a0">&#39;</span>, self<span style="color:#666">.</span>ssid)

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_dr_to_sf</span>(self, dr):
        sf <span style="color:#666">=</span> dr[<span style="color:#40a070">2</span>:<span style="color:#40a070">4</span>]
        <span style="color:#007020;font-weight:bold">if</span> sf[<span style="color:#40a070">1</span>] <span style="color:#007020;font-weight:bold">not</span> <span style="color:#007020;font-weight:bold">in</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">0123456789</span><span style="color:#4070a0">&#39;</span>:
            sf <span style="color:#666">=</span> sf[:<span style="color:#40a070">1</span>]
        <span style="color:#007020;font-weight:bold">return</span> <span style="color:#007020">int</span>(sf)

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_dr_to_bw</span>(self, dr):
        bw <span style="color:#666">=</span> dr[<span style="color:#666">-</span><span style="color:#40a070">5</span>:]
        <span style="color:#007020;font-weight:bold">if</span> bw <span style="color:#666">==</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">BW125</span><span style="color:#4070a0">&#39;</span>:
            <span style="color:#007020;font-weight:bold">return</span> LoRa<span style="color:#666">.</span>BW_125KHZ
        <span style="color:#007020;font-weight:bold">elif</span> bw <span style="color:#666">==</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">BW250</span><span style="color:#4070a0">&#39;</span>:
            <span style="color:#007020;font-weight:bold">return</span> LoRa<span style="color:#666">.</span>BW_250KHZ
        <span style="color:#007020;font-weight:bold">else</span>:
            <span style="color:#007020;font-weight:bold">return</span> LoRa<span style="color:#666">.</span>BW_500KHZ

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_sf_bw_to_dr</span>(self, sf, bw):
        dr <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">SF</span><span style="color:#4070a0">&#39;</span> <span style="color:#666">+</span> <span style="color:#007020">str</span>(sf)
        <span style="color:#007020;font-weight:bold">if</span> bw <span style="color:#666">==</span> LoRa<span style="color:#666">.</span>BW_125KHZ:
            <span style="color:#007020;font-weight:bold">return</span> dr <span style="color:#666">+</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">BW125</span><span style="color:#4070a0">&#39;</span>
        <span style="color:#007020;font-weight:bold">elif</span> bw <span style="color:#666">==</span> LoRa<span style="color:#666">.</span>BW_250KHZ:
            <span style="color:#007020;font-weight:bold">return</span> dr <span style="color:#666">+</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">BW250</span><span style="color:#4070a0">&#39;</span>
        <span style="color:#007020;font-weight:bold">else</span>:
            <span style="color:#007020;font-weight:bold">return</span> dr <span style="color:#666">+</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">BW500</span><span style="color:#4070a0">&#39;</span>

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_lora_cb</span>(self, lora):
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        LoRa radio events callback handler.</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

        events <span style="color:#666">=</span> lora<span style="color:#666">.</span>events()
        <span style="color:#007020;font-weight:bold">if</span> events <span style="color:#666">&amp;</span> LoRa<span style="color:#666">.</span>RX_PACKET_EVENT:
            self<span style="color:#666">.</span>rxnb <span style="color:#666">+</span><span style="color:#666">=</span> <span style="color:#40a070">1</span>
            self<span style="color:#666">.</span>rxok <span style="color:#666">+</span><span style="color:#666">=</span> <span style="color:#40a070">1</span>
            rx_data <span style="color:#666">=</span> self<span style="color:#666">.</span>lora_sock<span style="color:#666">.</span>recv(<span style="color:#40a070">256</span>)
            stats <span style="color:#666">=</span> lora<span style="color:#666">.</span>stats()
            packet <span style="color:#666">=</span> self<span style="color:#666">.</span>_make_node_packet(rx_data, self<span style="color:#666">.</span>rtc<span style="color:#666">.</span>now(), stats<span style="color:#666">.</span>rx_timestamp, stats<span style="color:#666">.</span>sfrx, self<span style="color:#666">.</span>bw, stats<span style="color:#666">.</span>rssi, stats<span style="color:#666">.</span>snr)
            self<span style="color:#666">.</span>_push_data(packet)
            self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Received packet: {}</span><span style="color:#4070a0">&#39;</span>, packet)
            self<span style="color:#666">.</span>rxfw <span style="color:#666">+</span><span style="color:#666">=</span> <span style="color:#40a070">1</span>
        <span style="color:#007020;font-weight:bold">if</span> events <span style="color:#666">&amp;</span> LoRa<span style="color:#666">.</span>TX_PACKET_EVENT:
            self<span style="color:#666">.</span>txnb <span style="color:#666">+</span><span style="color:#666">=</span> <span style="color:#40a070">1</span>
            lora<span style="color:#666">.</span>init(
                mode<span style="color:#666">=</span>LoRa<span style="color:#666">.</span>LORA,
                region<span style="color:#666">=</span>LoRa<span style="color:#666">.</span>EU868,
                frequency<span style="color:#666">=</span>self<span style="color:#666">.</span>frequency,
                bandwidth<span style="color:#666">=</span>self<span style="color:#666">.</span>bw,
                sf<span style="color:#666">=</span>self<span style="color:#666">.</span>sf,
                preamble<span style="color:#666">=</span><span style="color:#40a070">8</span>,
                coding_rate<span style="color:#666">=</span>LoRa<span style="color:#666">.</span>CODING_4_5,
                tx_iq<span style="color:#666">=</span>True
                )

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_freq_to_float</span>(self, frequency):
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        MicroPython has some inprecision when doing large float division.</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        To counter this, this method first does integer division until we</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        reach the decimal breaking point. This doesn</span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">t completely elimate</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        the issue in all cases, but it does help for a number of commonly</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        used frequencies.</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

        divider <span style="color:#666">=</span> <span style="color:#40a070">6</span>
        <span style="color:#007020;font-weight:bold">while</span> divider <span style="color:#666">&gt;</span> <span style="color:#40a070">0</span> <span style="color:#007020;font-weight:bold">and</span> frequency <span style="color:#666">%</span> <span style="color:#40a070">10</span> <span style="color:#666">==</span> <span style="color:#40a070">0</span>:
            frequency <span style="color:#666">=</span> frequency <span style="color:#666">/</span><span style="color:#666">/</span> <span style="color:#40a070">10</span>
            divider <span style="color:#666">-</span><span style="color:#666">=</span> <span style="color:#40a070">1</span>
        <span style="color:#007020;font-weight:bold">if</span> divider <span style="color:#666">&gt;</span> <span style="color:#40a070">0</span>:
            frequency <span style="color:#666">=</span> frequency <span style="color:#666">/</span> (<span style="color:#40a070">10</span> <span style="color:#666">*</span><span style="color:#666">*</span> divider)
        <span style="color:#007020;font-weight:bold">return</span> frequency

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_make_stat_packet</span>(self):
        now <span style="color:#666">=</span> self<span style="color:#666">.</span>rtc<span style="color:#666">.</span>now()
        STAT_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">stat</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">time</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#70a0d0;font-style:italic">%d</span><span style="color:#4070a0">-</span><span style="color:#70a0d0;font-style:italic">%02d</span><span style="color:#4070a0">-</span><span style="color:#70a0d0;font-style:italic">%02d</span><span style="color:#4070a0"> </span><span style="color:#70a0d0;font-style:italic">%02d</span><span style="color:#4070a0">:</span><span style="color:#70a0d0;font-style:italic">%02d</span><span style="color:#4070a0">:</span><span style="color:#70a0d0;font-style:italic">%02d</span><span style="color:#4070a0"> GMT</span><span style="color:#4070a0">&#34;</span> <span style="color:#666">%</span> (now[<span style="color:#40a070">0</span>], now[<span style="color:#40a070">1</span>], now[<span style="color:#40a070">2</span>], now[<span style="color:#40a070">3</span>], now[<span style="color:#40a070">4</span>], now[<span style="color:#40a070">5</span>])
        STAT_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">stat</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxnb</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> self<span style="color:#666">.</span>rxnb
        STAT_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">stat</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxok</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> self<span style="color:#666">.</span>rxok
        STAT_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">stat</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxfw</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> self<span style="color:#666">.</span>rxfw
        STAT_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">stat</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">dwnb</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> self<span style="color:#666">.</span>dwnb
        STAT_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">stat</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">txnb</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> self<span style="color:#666">.</span>txnb
        <span style="color:#007020;font-weight:bold">return</span> ujson<span style="color:#666">.</span>dumps(STAT_PK)

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_make_node_packet</span>(self, rx_data, rx_time, tmst, sf, bw, rssi, snr):
        RX_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#40a070">0</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">time</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#70a0d0;font-style:italic">%d</span><span style="color:#4070a0">-</span><span style="color:#70a0d0;font-style:italic">%02d</span><span style="color:#4070a0">-</span><span style="color:#70a0d0;font-style:italic">%02d</span><span style="color:#4070a0">T</span><span style="color:#70a0d0;font-style:italic">%02d</span><span style="color:#4070a0">:</span><span style="color:#70a0d0;font-style:italic">%02d</span><span style="color:#4070a0">:</span><span style="color:#70a0d0;font-style:italic">%02d</span><span style="color:#4070a0">.</span><span style="color:#70a0d0;font-style:italic">%d</span><span style="color:#4070a0">Z</span><span style="color:#4070a0">&#34;</span> <span style="color:#666">%</span> (rx_time[<span style="color:#40a070">0</span>], rx_time[<span style="color:#40a070">1</span>], rx_time[<span style="color:#40a070">2</span>], rx_time[<span style="color:#40a070">3</span>], rx_time[<span style="color:#40a070">4</span>], rx_time[<span style="color:#40a070">5</span>], rx_time[<span style="color:#40a070">6</span>])
        RX_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#40a070">0</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">tmst</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> tmst
        RX_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#40a070">0</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">freq</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> self<span style="color:#666">.</span>_freq_to_float(self<span style="color:#666">.</span>frequency)
        RX_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#40a070">0</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">datr</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> self<span style="color:#666">.</span>_sf_bw_to_dr(sf, bw)
        RX_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#40a070">0</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rssi</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> rssi
        RX_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#40a070">0</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">lsnr</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> snr
        RX_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#40a070">0</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">data</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> ubinascii<span style="color:#666">.</span>b2a_base64(rx_data)[:<span style="color:#666">-</span><span style="color:#40a070">1</span>]
        RX_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">rxpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#40a070">0</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">size</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> <span style="color:#007020">len</span>(rx_data)
        <span style="color:#007020;font-weight:bold">return</span> ujson<span style="color:#666">.</span>dumps(RX_PK)

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_push_data</span>(self, data):
        token <span style="color:#666">=</span> uos<span style="color:#666">.</span>urandom(<span style="color:#40a070">2</span>)
        packet <span style="color:#666">=</span> <span style="color:#007020">bytes</span>([PROTOCOL_VERSION]) <span style="color:#666">+</span> token <span style="color:#666">+</span> <span style="color:#007020">bytes</span>([PUSH_DATA]) <span style="color:#666">+</span> ubinascii<span style="color:#666">.</span>unhexlify(self<span style="color:#666">.</span>id) <span style="color:#666">+</span> data
        <span style="color:#007020;font-weight:bold">with</span> self<span style="color:#666">.</span>udp_lock:
            <span style="color:#007020;font-weight:bold">try</span>:
                self<span style="color:#666">.</span>sock<span style="color:#666">.</span>sendto(packet, self<span style="color:#666">.</span>server_ip)
            <span style="color:#007020;font-weight:bold">except</span> <span style="color:#007020">Exception</span> <span style="color:#007020;font-weight:bold">as</span> ex:
                self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Failed to push uplink packet to server: {}</span><span style="color:#4070a0">&#39;</span>, ex)

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_pull_data</span>(self):
        token <span style="color:#666">=</span> uos<span style="color:#666">.</span>urandom(<span style="color:#40a070">2</span>)
        packet <span style="color:#666">=</span> <span style="color:#007020">bytes</span>([PROTOCOL_VERSION]) <span style="color:#666">+</span> token <span style="color:#666">+</span> <span style="color:#007020">bytes</span>([PULL_DATA]) <span style="color:#666">+</span> ubinascii<span style="color:#666">.</span>unhexlify(self<span style="color:#666">.</span>id)
        <span style="color:#007020;font-weight:bold">with</span> self<span style="color:#666">.</span>udp_lock:
            <span style="color:#007020;font-weight:bold">try</span>:
                self<span style="color:#666">.</span>sock<span style="color:#666">.</span>sendto(packet, self<span style="color:#666">.</span>server_ip)
            <span style="color:#007020;font-weight:bold">except</span> <span style="color:#007020">Exception</span> <span style="color:#007020;font-weight:bold">as</span> ex:
                self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Failed to pull downlink packets from server: {}</span><span style="color:#4070a0">&#39;</span>, ex)

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_ack_pull_rsp</span>(self, token, error):
        TX_ACK_PK[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">txpk_ack</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">error</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">=</span> error
        resp <span style="color:#666">=</span> ujson<span style="color:#666">.</span>dumps(TX_ACK_PK)
        packet <span style="color:#666">=</span> <span style="color:#007020">bytes</span>([PROTOCOL_VERSION]) <span style="color:#666">+</span> token <span style="color:#666">+</span> <span style="color:#007020">bytes</span>([PULL_ACK]) <span style="color:#666">+</span> ubinascii<span style="color:#666">.</span>unhexlify(self<span style="color:#666">.</span>id) <span style="color:#666">+</span> resp
        <span style="color:#007020;font-weight:bold">with</span> self<span style="color:#666">.</span>udp_lock:
            <span style="color:#007020;font-weight:bold">try</span>:
                self<span style="color:#666">.</span>sock<span style="color:#666">.</span>sendto(packet, self<span style="color:#666">.</span>server_ip)
            <span style="color:#007020;font-weight:bold">except</span> <span style="color:#007020">Exception</span> <span style="color:#007020;font-weight:bold">as</span> ex:
                self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">PULL RSP ACK exception: {}</span><span style="color:#4070a0">&#39;</span>, ex)

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_send_down_link</span>(self, data, tmst, datarate, frequency):
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        Transmits a downlink message over LoRa.</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

        self<span style="color:#666">.</span>lora<span style="color:#666">.</span>init(
            mode<span style="color:#666">=</span>LoRa<span style="color:#666">.</span>LORA,
            region<span style="color:#666">=</span>LoRa<span style="color:#666">.</span>EU868,
            frequency<span style="color:#666">=</span>frequency,
            bandwidth<span style="color:#666">=</span>self<span style="color:#666">.</span>_dr_to_bw(datarate),
            sf<span style="color:#666">=</span>self<span style="color:#666">.</span>_dr_to_sf(datarate),
            preamble<span style="color:#666">=</span><span style="color:#40a070">8</span>,
            coding_rate<span style="color:#666">=</span>LoRa<span style="color:#666">.</span>CODING_4_5,
            tx_iq<span style="color:#666">=</span>True
            )
        <span style="color:#007020;font-weight:bold">while</span> utime<span style="color:#666">.</span>ticks_diff(utime<span style="color:#666">.</span>ticks_cpu(), tmst) <span style="color:#666">&gt;</span> <span style="color:#40a070">0</span>:
            <span style="color:#007020;font-weight:bold">pass</span>
        self<span style="color:#666">.</span>lora_sock<span style="color:#666">.</span>settimeout(<span style="color:#40a070">1</span>)
        self<span style="color:#666">.</span>lora_sock<span style="color:#666">.</span>send(data)
        self<span style="color:#666">.</span>lora_sock<span style="color:#666">.</span>setblocking(False)
        self<span style="color:#666">.</span>_log(
            <span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Sent downlink packet scheduled on {:.3f}, at {:,d} Hz using {}: {}</span><span style="color:#4070a0">&#39;</span>,
            tmst <span style="color:#666">/</span> <span style="color:#40a070">1000000</span>,
            frequency,
            datarate,
            data
        )

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_udp_thread</span>(self):
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        UDP thread, reads data from the server and handles it.</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

        <span style="color:#007020;font-weight:bold">while</span> <span style="color:#007020;font-weight:bold">not</span> self<span style="color:#666">.</span>udp_stop:
            gc<span style="color:#666">.</span>collect()
            <span style="color:#007020;font-weight:bold">try</span>:
                data, src <span style="color:#666">=</span> self<span style="color:#666">.</span>sock<span style="color:#666">.</span>recvfrom(<span style="color:#40a070">1024</span>)
                _token <span style="color:#666">=</span> data[<span style="color:#40a070">1</span>:<span style="color:#40a070">3</span>]
                _type <span style="color:#666">=</span> data[<span style="color:#40a070">3</span>]
                <span style="color:#007020;font-weight:bold">if</span> _type <span style="color:#666">==</span> PUSH_ACK:
                    self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">Push ack</span><span style="color:#4070a0">&#34;</span>)
                <span style="color:#007020;font-weight:bold">elif</span> _type <span style="color:#666">==</span> PULL_ACK:
                    self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">Pull ack</span><span style="color:#4070a0">&#34;</span>)
                <span style="color:#007020;font-weight:bold">elif</span> _type <span style="color:#666">==</span> PULL_RESP:
                    self<span style="color:#666">.</span>dwnb <span style="color:#666">+</span><span style="color:#666">=</span> <span style="color:#40a070">1</span>
                    ack_error <span style="color:#666">=</span> TX_ERR_NONE
                    tx_pk <span style="color:#666">=</span> ujson<span style="color:#666">.</span>loads(data[<span style="color:#40a070">4</span>:])
                    payload <span style="color:#666">=</span> ubinascii<span style="color:#666">.</span>a2b_base64(tx_pk[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">txpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">data</span><span style="color:#4070a0">&#34;</span>])
                    <span style="color:#60a0b0;font-style:italic"># depending on the board, pull the downlink message 1 or 6 ms upfronnt</span>
                    tmst <span style="color:#666">=</span> utime<span style="color:#666">.</span>ticks_add(tx_pk[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">txpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">tmst</span><span style="color:#4070a0">&#34;</span>], self<span style="color:#666">.</span>window_compensation)
                    t_us <span style="color:#666">=</span> utime<span style="color:#666">.</span>ticks_diff(utime<span style="color:#666">.</span>ticks_cpu(), utime<span style="color:#666">.</span>ticks_add(tmst, <span style="color:#666">-</span><span style="color:#40a070">15000</span>))
                    <span style="color:#007020;font-weight:bold">if</span> <span style="color:#40a070">1000</span> <span style="color:#666">&lt;</span> t_us <span style="color:#666">&lt;</span> <span style="color:#40a070">10000000</span>:
                        self<span style="color:#666">.</span>uplink_alarm <span style="color:#666">=</span> Timer<span style="color:#666">.</span>Alarm(
                            handler<span style="color:#666">=</span><span style="color:#007020;font-weight:bold">lambda</span> x: self<span style="color:#666">.</span>_send_down_link(
                                payload,
                                tmst, tx_pk[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">txpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">datr</span><span style="color:#4070a0">&#34;</span>],
                                <span style="color:#007020">int</span>(tx_pk[<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">txpk</span><span style="color:#4070a0">&#34;</span>][<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">freq</span><span style="color:#4070a0">&#34;</span>] <span style="color:#666">*</span> <span style="color:#40a070">1000</span> <span style="color:#666">+</span> <span style="color:#40a070">0.0005</span>) <span style="color:#666">*</span> <span style="color:#40a070">1000</span>
                            ),
                            us<span style="color:#666">=</span>t_us
                        )
                    <span style="color:#007020;font-weight:bold">else</span>:
                        ack_error <span style="color:#666">=</span> TX_ERR_TOO_LATE
                        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Downlink timestamp error!, t_us: {}</span><span style="color:#4070a0">&#39;</span>, t_us)
                    self<span style="color:#666">.</span>_ack_pull_rsp(_token, ack_error)
                    self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#34;</span><span style="color:#4070a0">Pull rsp</span><span style="color:#4070a0">&#34;</span>)
            <span style="color:#007020;font-weight:bold">except</span> usocket<span style="color:#666">.</span>timeout:
                <span style="color:#007020;font-weight:bold">pass</span>
            <span style="color:#007020;font-weight:bold">except</span> <span style="color:#007020">OSError</span> <span style="color:#007020;font-weight:bold">as</span> ex:
                <span style="color:#007020;font-weight:bold">if</span> ex<span style="color:#666">.</span>args[<span style="color:#40a070">0</span>] <span style="color:#666">!=</span> errno<span style="color:#666">.</span>EAGAIN:
                    self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">UDP recv OSError Exception: {}</span><span style="color:#4070a0">&#39;</span>, ex)
            <span style="color:#007020;font-weight:bold">except</span> <span style="color:#007020">Exception</span> <span style="color:#007020;font-weight:bold">as</span> ex:
                self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">UDP recv Exception: {}</span><span style="color:#4070a0">&#39;</span>, ex)

            self<span style="color:#666">.</span>watchdog<span style="color:#666">.</span>feed()
            <span style="color:#60a0b0;font-style:italic"># self._log(&#34;Feeding the dog&#34;)</span>

            <span style="color:#60a0b0;font-style:italic"># wait before trying to receive again</span>
            utime<span style="color:#666">.</span>sleep_ms(UDP_THREAD_CYCLE_MS)

        <span style="color:#60a0b0;font-style:italic"># we are to close the socket</span>
        self<span style="color:#666">.</span>sock<span style="color:#666">.</span>close()
        self<span style="color:#666">.</span>udp_stop <span style="color:#666">=</span> False
        self<span style="color:#666">.</span>_log(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">UDP thread stopped</span><span style="color:#4070a0">&#39;</span>)

    <span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">_log</span>(self, message, <span style="color:#666">*</span>args):
        <span style="color:#4070a0"></span><span style="color:#4070a0">&#34;&#34;&#34;</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        Outputs a log message to stdout.</span><span style="color:#4070a0">
</span><span style="color:#4070a0"></span><span style="color:#4070a0">        </span><span style="color:#4070a0">&#34;&#34;&#34;</span>

        <span style="color:#007020;font-weight:bold">print</span>(<span style="color:#4070a0"></span><span style="color:#4070a0">&#39;</span><span style="color:#4070a0">[{:&gt;10.3f}] {}</span><span style="color:#4070a0">&#39;</span><span style="color:#666">.</span>format(
            utime<span style="color:#666">.</span>ticks_ms() <span style="color:#666">/</span> <span style="color:#40a070">1000</span>,
            <span style="color:#007020">str</span>(message)<span style="color:#666">.</span>format(<span style="color:#666">*</span>args)
            ))

</code></pre></div><h2 id="nano-gateway-node">Nano-gateway node</h2>
<p>As the gateway only supports a single channel, we need to setup our nodes to only send packets over that channel. The node can either use OTAA or ABP, but we&rsquo;ll have to setup the correct channel. Use the following example to setup the correct channels for EU868. This can be modified for use in 915MHz regions as well:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#60a0b0;font-style:italic"># remove all the default channels for EU868</span>
<span style="color:#007020;font-weight:bold">for</span> i <span style="color:#007020;font-weight:bold">in</span> <span style="color:#007020">range</span>(<span style="color:#40a070">3</span>, <span style="color:#40a070">16</span>):
    lora<span style="color:#666">.</span>remove_channel(i)

<span style="color:#60a0b0;font-style:italic"># set the 3 default channels to the same frequency (must be before sending the join request)</span>
lora<span style="color:#666">.</span>add_channel(<span style="color:#40a070">0</span>, frequency<span style="color:#666">=</span><span style="color:#40a070">868100000</span>, dr_min<span style="color:#666">=</span><span style="color:#40a070">0</span>, dr_max<span style="color:#666">=</span><span style="color:#40a070">5</span>)
lora<span style="color:#666">.</span>add_channel(<span style="color:#40a070">1</span>, frequency<span style="color:#666">=</span><span style="color:#40a070">868100000</span>, dr_min<span style="color:#666">=</span><span style="color:#40a070">0</span>, dr_max<span style="color:#666">=</span><span style="color:#40a070">5</span>)
lora<span style="color:#666">.</span>add_channel(<span style="color:#40a070">2</span>, frequency<span style="color:#666">=</span><span style="color:#40a070">868100000</span>, dr_min<span style="color:#666">=</span><span style="color:#40a070">0</span>, dr_max<span style="color:#666">=</span><span style="color:#40a070">5</span>)

<span style="color:#60a0b0;font-style:italic"># remove all the default channels for US915 / AU915</span>
<span style="color:#007020;font-weight:bold">for</span> i <span style="color:#007020;font-weight:bold">in</span> <span style="color:#007020">range</span>(<span style="color:#40a070">3</span>, <span style="color:#40a070">64</span>):
    lora<span style="color:#666">.</span>remove_channel(i)

<span style="color:#60a0b0;font-style:italic"># set the 3 default channels to the same frequency (must be before sending the join request)</span>
lora<span style="color:#666">.</span>add_channel(<span style="color:#40a070">0</span>, frequency<span style="color:#666">=</span><span style="color:#40a070">903900000</span>, dr_min<span style="color:#666">=</span><span style="color:#40a070">0</span>, dr_max<span style="color:#666">=</span><span style="color:#40a070">3</span>)
lora<span style="color:#666">.</span>add_channel(<span style="color:#40a070">1</span>, frequency<span style="color:#666">=</span><span style="color:#40a070">903900000</span>, dr_min<span style="color:#666">=</span><span style="color:#40a070">0</span>, dr_max<span style="color:#666">=</span><span style="color:#40a070">3</span>)
lora<span style="color:#666">.</span>add_channel(<span style="color:#40a070">2</span>, frequency<span style="color:#666">=</span><span style="color:#40a070">903900000</span>, dr_min<span style="color:#666">=</span><span style="color:#40a070">0</span>, dr_max<span style="color:#666">=</span><span style="color:#40a070">3</span>)
</code></pre></div><h2 id="registering-with-ttn">Registering with TTN</h2>
<p>Please check the <a href="../../../../gettingstarted/registration/lora/index.html">LoRaWAN Device Registration</a> page for more information</p>
</v-card-text>
</v-card>
    <p>&nbsp;</p>
    






  
  
    
  
  

  
  
    
  
  

  
  
    
  
  
    
    
    
      
    
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
      
      
    
    
  

  
  
    
  
  
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
        
        
        
          
        
        
        
      
      
      
      
        
      
      
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
      
      
      
      
        
      
      
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
          
          
          
        
        
        
      <v-layout class="full-width  prev-next pa-2 mt-4 mb-0" styleZZ="background-color: #7800FF;">
  <v-flex xs6 class="ppurple">
  
  <v-btn class="ml-4" href="/tutorials/networks/lora/lorawan-otaa/">Previous</v-btn>
  
  </v-flex>
  <v-flex xs6 class="text-xs-right">
  <v-btn class="mr-4 pbgpurple white--text"  href="/tutorials/networks/lora/lora-mac/">Next</v-btn>
    </v-flex>
</v-layout>

        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
      
      
      
      
        
      
      
        
        
        
          
        
        
        
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
    
    
  

  
  
    
  
  
    
    
    
      
    
    
      
      
      
        
      
      
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
      
      
      
      
        
      
      
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
          
          
          
            
          
          
          
          
            
          
          
          
          
            
          
          
          
          
            
          
          
          
          
            
          
          
          
          
            
          
          
          
          
            
          
          
        
        
        
          
        
        
        
          
          
          
            
          
          
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
        
        
          
        
        
        
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
    
  

  
  
    
  
  
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
    
  

  
  
    
  
  
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
  

  
  
    
  
  
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
      
      
      
        
      
      
        
        
        
          
        
        
        
      
      
      
      
        
      
      
        
        
        
          
        
        
        
        
        
          
        
        
        
      
      
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
  

  
  
    
  
  
    
    
    
      
    
    
      
      
      
        
      
      
      
      
      
        
      
      
      
    
    
    
    
      
    
    
    
    
    
      
    
    
    
  

  
  
    
  
  
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
  

  
  
    
  
  
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
  

  
  
    
  
  
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
  

  
  
    
  
  
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
    
    
      
    
    
    
  

  
  
    
  
  


    <v-spacer/>


          </v-container>
      </v-container>
    </v-content>
 </v-app>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vuetify/1.5.13/vuetify.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/1.5.1/vue-resource.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script>
    var development = false;
    var app = new Vue({
      el: '#app',
      data: {
        page: 1,
        pageCount: 0,
        error: null,
        results: null,
        drawer: true,
        drawer2: true,
        toc: 0,
        branches: [
        { value: 'https://docs.pycom.io', text: 'version stable'},
          { value: 'https://development.pycom.io', text: 'version development'},
          

        ],
        branch: ""
      },
      mounted: function () {
        
        this.branch= this.branches[0]
        for (b in this.branches) {
          if ( document.location.href.indexOf(this.branches[b].value) > -1) {
            this.branch= this.branches[b]
          }
        }
        
        
        if (this.$refs.tocBtn) {
          var elem = this.$refs.tocBtn.$el
          setTimeout(function () {
              elem.click();

          }, 3500);
        }
        var elem2 = document.getElementById("vuetify-theme-stylesheet");
        elem2.parentNode.removeChild(elem2);

      },
      watch: {
        
        branch: function (newb, old) {
          if (newb.value != this.branches[0].value) {
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
            window.location = newb + window.location.pathname;
          }
        },
      },
    });

    
    docsearch({
      apiKey: 'a99fde9999fbec81c1772eb9ffcca488',
      indexName: 'pycom',
      inputSelector: '.algolia-search-field input',
      debug: false 
    });
  </script>
<script type="text/javascript">
_atrk_opts = { atrk_acct:"WpWNq1SZw320l9", domain:"pycom.io",dynamic: true};
(function() { var as = document.createElement('script'); as.type = 'text/javascript'; as.async = true; as.src = "https://certify-js.alexametrics.com/atrk.js"; var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(as, s); })();
</script>
<noscript><img src="https://certify.alexametrics.com/atrk.gif?account=WpWNq1SZw320l9" style="display:none" height="1" width="1" alt="" /></noscript>


<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:1216663,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-72107804-3', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>
